/*!
 *AssetManager Q v0.0.2
 */
!function(a,b){"function"==typeof define&&define.amd?define(["Q"],b,function(c){a.AssetManager=b(c)}):a.AssetManager=b(Q)}(this,function(a){"use strict";function b(a){return Array.prototype.slice.call(a,0)}function c(a,b){return typeof a===b}function d(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)}function e(a){return!(!a||!c(a,"object"))}function f(a){return c(a,"string")||"[object String]"===Object.prototype.toString.call(a)}function g(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function h(){return arguments[0].concat(arguments[0],Array.prototype.slice.call(arguments,1))}function i(a){return d(a)?a.length:0}function j(a,c){if(Array.prototype.forEach)return Array.prototype.forEach.apply(a,Array.prototype.slice.call(arguments,1));for(var d=i(b(arguments))>2?arguments[2]:void 0,e=0,f=i(a);f>e;e++)c.apply(d,[a[e],e,a])}var k={PENDING:0,LOADING:1,LOADED:2};function l(a,b){this.id=a,this.src=b,this.state=k.PENDING}l.prototype.setState=function(a){this.state=a},l.prototype.isLoaded=function(){return this.state===k.state};function m(){this._assets=[],this._id=0}return m.prototype.add=function(){var a=b(arguments),c=null,h=this._assets;return j(a,function(a){if(d(a))return void this.add.apply(this,a);if(!e(a)||g(a,"src")&&m.supportedFormat(a.src)){if(e(a))c=new l(g(a,"id")?a.id:this._id++,a.src);else{if(f(a)&&!m.supportedFormat(a))return;f(a)&&(c=new l(this._id++,a))}h.push(c)}},this),this},m.prototype.load=function(){var b=this._assets,c=a.defer(),d=null,e=i(b),f=0;return e>0?j(b,function(a){d=new Image,d.onload=function(){a.setState(k.LOADED),f++,f===e&&c.resolve(b)},a.setState(k.LOADING),d.src=a.src}):c.resolve(b),c.promise},m.prototype.isLoaded=function(a){var b=null,c=null,d=e(a),h=f(a);if(!d||!h)return!1;if(d&&a instanceof l)return a.loaded();if(d?(b=g(a,"id")?a.id:null,c=g(a,"src")?a.src:null):h&&(c=a),!b||!c)return!1;for(var j=this._assets,k=0,m=i(j);m>k;k++)if(j[k].id===b||j[k].src===c)return j[k].loaded();return!1},m.supportedFormatRe=new RegExp(".+\\.(gif|png|jpg|jpeg)$","i"),m.supportedFormat=function(a){if(!f(a))throw new Error("Supported only accepts strings to test");return m.supportedFormatRe.test(a)},m});